\chapter{Framework Architecture}
The reprotools \todo{name subject to change } is a set of tools developed to for the analysis of files to identify the reproducibility issues occuring in the neuroimages. Though this framework is particularly developed with neuroimaging in focus, it can be used to analyze files belonging to any discipline. In this particular usecase, the HCP data containing the neuroimaging data processed under different conditions is analyzed. Under an ideal scenario, different HCP subjects, irrespective of the condition under which the processing takes place, are supposed to have identical checksum. Repro-tool helps in identifying the files having differences and also it can quantify these differences with the help of metrics. Reprotools can also trace the provenance of these differences with the help of data captured with the help of Reprozip.

  \begin{itemize}
  \item Collecting data from the Human Connectome Preprocessing Pipelines \cite{DBHumanConnectome}
  \item Creation of docker images containing the HCP Preprocessing pipelines
  \item Deploying the docker images with the help of Boutiques (A cross-platform application repository for data-analysis platforms) to CBRAIN
  \item Processing of HCP data set using pipelines and measures to check file corruption, recording the software and hardware specifications, provenance capture
  \item Analysis of processed HCP data
  \end{itemize}

\section{Pipeline Containerization}

\subsection{Docker images}
The study of neuroimaging pipelines is conducted on CentOS\footnote{\url{https://en.wikipedia.org/wiki/CentOS}} (Community Enterprise Operating System). According to~\cite{CentOS}, ``CentOS is for people who need an enterprise class operating system stability without the cost of certification and support". CentOS operating system is known for its rock-solid reliability, safety, portability, openness and the long product lifecycle~\cite{5665431}. All these qualities make CentOS a popular choice among the research community and
high performance computing clusters. We conducted our study across the below listed CentOS operating system versions.\\

\begin{itemize}
  \item Linux CentOS 5.11
  \item Linux CentOS 6.8
  \item Linux CentOS 7.2.1511
\end{itemize}

Docker containers were created out of the base version images listed above. These containers were installed with all the necessary softwares and libraries required to run the HCP pipelines. HCP pipelines prerequisites are listed below,\\

\begin{itemize}
\item A 64-bit Linux Operating System
\item FSL Version - 5.0.6
\item FreeSurfer Version - 5.3.0-HCP
\item Connectome Workbench Version - 1.0
\item HCP version of gradunwarp version 1.0.2 (this is optional and needs to be installed only if gradient nonlinearity corrections needs to be done)
\end{itemize}


\subsubsection{HCP Pipelines (v3.19.0)}
\begin{itemize}
  \item FreeSurfer
  \item PreFreesurfer
  \item PostFreeSurfer
  \item fMRIVolume
\end{itemize}

\section{Pipeline Encapsulation}
\begin{itemize}
  \item Describes the command-line interface of the pipeline
  \item Adds checksum to prevent input data corruption
  \item Checks container image identifier
  \item Records all the software (library versions) and hardware specifications
\end{itemize}

\section{Pipeline Deployment}
\begin{itemize}
  \item Single server to ensure no hardware differences
  \item Able to process multiple subjects at once
  \item CBRAIN HCP plugins available here
\end{itemize}

\section{Provenance Capture}
\begin{flushleft}
For every output file, Reprozip captures: 
\end{flushleft}
\begin{itemize}
  \item Process that wrote the file
  \item Command line arguments
  \item Environment variables
  \item Timestamp
  \item Working Directory
\end{itemize}

\section{File comparisions across conditions}
\begin{itemize}
 \item Identify the files that are common to all subjects and all conditions
 \item Check intra-OS variability (e.g., due to pseudo-random processes)
 \item Identifies files with differences (based on md5 checksum)
 \item Associates file types with specific metrics (Normalized RMSE, Text filters, Dice coefficient)
 \item Computes difference matrix for each metric and associates matrix with Reprozip trace
\end{itemize}

\subsection{Metrics}
\begin{itemize}
\item NRMSE
\item Checksum
\item Dice
\item Hardware Differences
\end{itemize}
