\chapter{Results}
This chapter discusses the results we obtained by processing data using the HCP pipelines. The differences we observed and the quantified metric values are discussed in detail for each pipeline. Section \ref{sec:Prefreesurfer} discusses PrefreeSurfer results, followed by section \ref{sec:Freesurfer} on FreeSurfer results, section \ref{sec:Postfreesurfer} on PostFreeSurfer results and finally section \ref{sec:fMRI} discusses fMRIVolume pipeline results.

\section{PreFreeSurfer} \label{sec:Prefreesurfer}
The subjects were processed on CentOS6 and CentOS7 using the PreFreeSurfer pipeline. Among the 92 NIfTI imaging files common to all 5 subjects, 76 (.nii.gz) files differed between CentOS6 and CentOS7. Figure~\ref{fig:prefreesurfer_metric_values} shows the Dice coefficient and NRMSE values of the NIfTI files that were found to have differences in between operating systems.

\subsection{Global comparison}
The general findings about the differences in the output images due to the PreFreeSurfer processing is discussed in this section.

\hfill \break
\begin{center}
\begin{tabular}{|l|l|l|}
\hline
\textbf{Item}      & \textbf{Nrmse} & \textbf{Dice} \\ \hline
Mean               & 0.0088   & 0.3212   \\ \hline
Median             & 0.0043    & 0.0557    \\ \hline
Standard Deviation & 0.0160    & 0.3806   \\ \hline
\end{tabular}
\captionof{table}{NRMSE \& DICE values for PreFreeSurfer processing on CentOS6 and CentOS7}
\label{tab:PreFreeSurfer_Metic_Values}
\end{center}
\hfill \break

Table \ref{tab:PreFreeSurfer_Metic_Values} contains the average mean, median and standard deviation we calculated for the metrics, NRMSE value and Dice coefficient. Dice coefficient shows that out of the results we obtained from PreFreeSurfer processing on two conditions, there was only 32\% similarity while taking the average of Dice coeffiecient of every file that we found to have a checksum difference. The average Dice coefficient is very low, which means that majority of the images are dissimilar.

\hfill \break
\begin{center}
\includegraphics[width=.5\linewidth]{prefreesurfer_nrmse.png}%
\includegraphics[width=.5\linewidth]{prefreesurfer_dice.png}
\captionof{figure}{PreFreeSurfer metric values}
\caption*{(i) NRMSE (left) (ii)Dice coefficient (right)}
\label{fig:prefreesurfer_metric_values}
\end{center}
\hfill \break

Figure \ref{fig:prefreesurfer_metric_values} contains the matrices showing the plotted values of NRMSE (left) and Dice Coefficient (right).
Each line in the matrix corresponds to a file common to all the subjects.
Each column represents a subject and each row represents the same file in 5 different subjects. The files are sorted according to their modification time.
The NRMSE value appears brighter if the images are dissimilar and it appears darker if the images are similar. Conversely, the Dice coefficient value appears darker if the images are dissimilar and appears brighter if the images are similar. We can also observe that the magnitude of differences varies across the files as well as the subjects.

\subsection{Comparison of specific files}
Figure~\ref{fig:prefreesurfer_t1w_acpc} illustrates the binarized differences in the ``T1wmulT2w\_brain\_norm\_s5.nii.gz file". The file was taken from subject ``101410". File has an NRMSE value of 0.021 and the Dice coefficient value is 0.007. The thick blue shaded region shows the difference in between the images in two conditions (CentOS6 and CentOS7).

\hfill \break
\begin{center}
\includegraphics[width=.9\linewidth]{t1wmul1.png}
  \captionof{figure}{PreFreeSurfer T1wmulT2w brain normalization file (Blue shaded region shows the binarized differences and the green shaded region around the border is part of file from CentOS6). \href{https://drive.google.com/file/d/1RYlwkn6Aqul9DeljxnC78FpJhoVQBElP/view?usp=sharing}{Link}}
\caption*{(Subject: 101410; Filename: T1wmulT2w\_brain\_norm\_s5.nii.gz; Dice coeff.: 0.007 ; NRMSE: 0.021)}
\label{fig:prefreesurfer_t1w_acpc}
\end{center}
\hfill \break

Figure~\ref{fig:prefreesurfer_t2w_acpc} illustrates the differences in the ``T2w\_acpc\_nii.gz". The file was taken from subject ``105216". File has an NRMSE value of 0.0065 and the Dice coefficient value is 0.6*10\textsuperscript{-6}. The square pixels in the image shows the differences in between two conditions (CentOS6 and CentOS7).

\hfill \break
\begin{center}
\includegraphics[width=.3\linewidth]{checkerboard_T2w_1.png}%
\includegraphics[width=.3\linewidth]{checkerboard_T2w_2.png}%
\includegraphics[width=.3\linewidth]{checkerboard_T2w_3.png}
\captionof{figure}{PreFreeSurfer T2w ACPC file (Pixellated voxels shows the differences).\href{https://drive.google.com/file/d/1NrNl7POyCS_SZm3an00wOLUnkmLJ_ngo/view?usp=sharing}{Link}}
\caption*{(Subject: 105216; Filename: T2w\_acpc\_nii.gz; Dice coeff.: 0.6*10\textsuperscript{-6} ; NRMSE: 0.0065)}
\label{fig:prefreesurfer_t2w_acpc}
\end{center}
\vskip 0.2in

The visualization of the differences in T2w ACPC file given in the link above, shows that the images from two conditions are totally out of alignment. This differnence is the result of PreFreeSurfer processing (step (4), Figure \ref{fig:prefreesurfer_overview}). The linear registration done using FLIRT creates the difference.

\vskip 0.2in
Figure~\ref{fig:prefreesurfer_std_file} illustrates the differences in the ``standard2str.nii.gz". The file was taken from subject ``105216". File has an NRMSE value of 0.036 and the Dice coefficient value is 0.2*10\textsuperscript{-7}. The red color in the images shows the (binarized) differences in the images in between two conditions (CentOS6 and CentOS7).

\hfill \break
\begin{center}
\includegraphics[width=.99\linewidth]{std2str.png}
\captionof{figure}{Illustrates the differences in the standard2std file. \href{https://drive.google.com/file/d/1ffPVXBT2GZ-le3kQzfwvxS_0Z7StnGrk/view?usp=sharing}{Link}}
\caption*{(Subject: 105216; Filename: standard2str.nii.gz; Dice coeff.: 0.2*10\textsuperscript{-7} ; NRMSE: 0.036)}
\label{fig:prefreesurfer_std_file}
\end{center}
\hfill \break

\section{FreeSurfer} \label{sec:Freesurfer}
FreeSurfer results presented in this section do not take into account the files that were found to be different in PreFreeSurfer pipeline. The number of files that have differences and which are common to all the subjects, was found to be 61 files (23 .nii.gz files and 38 .mgz files).

\subsection{Global comparison}
The general findings about the differences in the output images due to the FreeSurfer processing is discussed in this section.
\hfill \break
\begin{center}
\begin{tabular}{|l|l|l|}
\hline
\textbf{Item}      & \textbf{Nrmse} & \textbf{Dice} \\ \hline
Mean               & 0.0177    & 0.6953  \\ \hline
Median             & 0.0098    & 0.9262   \\ \hline
Standard Deviation & 0.0181     & 0.4051   \\ \hline
\end{tabular}
\captionof{table}{NRMSE \& DICE values for FreeSurfer processing on CentOS6 and CentOS7}
\label{tab:FreeSurfer_Metic_Values}
\end{center}
\hfill \break

Table \ref{tab:FreeSurfer_Metic_Values} contains the mean, median and standard deviation of files having differences from FreeSurfer preprocessing on CentOS6 and CentOS7.Dice Coefficient shows that out of the results we obtained from FreeSurfer processing on two conditions, there was 69\% similarity while taking the average of Dice coeffiecient of every file that we found to have a checksum difference. Average Dice coefficient value is high, which indicates that the FreeSurfer pipeline is more reliable than PreFreeSurfer pipeline.

\begin{center}
\includegraphics[width=.5\linewidth]{freesurfer-nrmse.png}%
\includegraphics[width=.5\linewidth]{freesurfer-dice.png}
\captionof{figure}{FreeSurfer metric values}
\caption*{(i) NRMSE (left) (ii)Dice Coefficient (right)}
\label{fig:freesurfer_metric_values}
\end{center}

Figure \ref{fig:freesurfer_metric_values} contains the matrices showing the plotted values of NRMSE (left) and Dice Coefficient (right). Each line in the matrix corresponds to a file common to all the subjects. Each column represents a subject and each row represents the same file in 5 different subjects. The NRMSE value appears brighter if the images are dissimilar and it appears darker if the images are similar. Conversely, the Dice coefficient value appears darker if the images are dissimiliar and appears brighter if the images are similar. We can also observe that the magnitude of differences varies across the files as well as the subjects.

\subsection{Comparison of specific files}
Figure~\ref{fig:freesurfer_ribbon_file} illustrates the differences in the ``ribbon.nii.gz" file. The file was taken from subject ``105216". The file illustrated here has an NRMSE value of 0.081 and the Dice coefficient value is 0.993. The red color in the image shows the difference in between the images in two conditions (CentOS6 and CentOS7).
\hfill \break
\begin{center}
\includegraphics[width=\linewidth]{ribbon_screenshot_freesurfer.png}
\captionof{figure}{Differences in the ribbon file from FreeSurfer Result (Red shaded region shows the differences). \href{https://drive.google.com/file/d/1YHV4PHGzkhgOVE5slMNoDksBMqHSLwjS/view?usp=sharing}{Link}}
\caption*{(Subject: 105216; Filename: ribbon.nii.gz; Dice coeff.: 0.993 ; NRMSE: 0.081)}
\label{fig:freesurfer_ribbon_file}
\end{center}
\hfill \break

Figure~\ref{fig:freesurfer_aseg_file} illustrates the differences in the ``aseg.hires.mgz" file. The file was taken from subject ``105216". The file illustrated here has an NRMSE value of 0.010 and the Dice coefficient value is 0.987. The yellow color in the image shows the difference in the images in between two conditions (CentOS6 and CentOS7).
\hfill \break
\begin{center}
\includegraphics[width=.99\linewidth]{aseg-hires-red.png}
\captionof{figure}{FreeSurfer Aseg hires file (Red shaded region shows the differences in the image in between two conditions). \href{https://drive.google.com/file/d/1WUwWp5muXvotbMQqTqR5LcMyncH1ET3P/view?usp=sharing}{Link}}
\caption*{(Subject: 105216; Filename: aseg.hires.mgz; Dice coeff.: 0.987 ; NRMSE: 0.010)}
\label{fig:freesurfer_aseg_file}
\end{center}
\hfill \break

Figure~\ref{fig:freesurfer_wm_file} illustrates the differences in the ``wm.hires.nii.gz" file. The file was taken from subject ``105216". The file illustrated here has an NRMSE value of 0.074 and the Dice coefficient value is 0.994. The grey color around the yellow shaded parts in the image shows the difference in the images in between two conditions (CentOS6 and CentOS7).

\hfill \break
\begin{center}
\includegraphics[width=.99\linewidth]{wm-red-white.png}
\captionof{figure}{FreeSurfer WM hire file (Red shaded region shows the file containing the difference). \href{https://drive.google.com/file/d/1PzR21tsDOZTqDOcoh1zFyDe7ZXB_LXfJ/view?usp=sharing}{Link}}
\caption*{(Subject: 105216; Filename: wm.hires.nii.gz; Dice coeff.: 0.994 ; NRMSE: 0.074)}
\label{fig:freesurfer_wm_file}
\end{center}
\hfill \break

\section{PostFreeSurfer}\label{sec:Postfreesurfer}
25 (.nii.gz) were found to have inter-OS differences after PostFreeSurfer processing. These files are created as part of PostFreeSurfer processing alone, and they are common to all the five subjects.

\subsection{Global comparison}
The general findings about the differences in the output images due to the PostFreeSurfer processing is discussed in this section.
\hfill \break
\begin{center}
\begin{tabular}{|l|l|l|}
\hline
\textbf{Item}      & \textbf{Nrmse} & \textbf{Dice} \\ \hline
Mean               & 0.0347     & 0.6768   \\ \hline
Median             & 0.0386    & 0.9829   \\ \hline
Standard Deviation & 0.0254    & 0.4584   \\ \hline
\end{tabular}
\captionof{table}{NRMSE \& DICE values for PostFreeSurfer processing on CentOS6 and CentOS7}
\label{tab:PostFreeSurfer_Metic_Values}
\end{center}
\hfill \break

Table \ref{tab:PostFreeSurfer_Metic_Values} contains the mean, median and standard deviation values of files having differences from PostFreeSurfer pipeline on CentOS6 and CentOS7 operating systems. Dice Coefficient shows that out of the results we obtained from PostFreeSurfer processing on two conditions, there was 67\% similarity while taking the average of Dice coefficient of every file that we found to have a checksum difference. This high value of Dice coefficient shows that the PostFreeSurfer pipeline is reliable.

\hfill \break
\begin{center}
\includegraphics[width=.5\linewidth]{postfreesurfer-nrmse.png}%
\includegraphics[width=.5\linewidth]{postfreesurfer-dice.png}
\captionof{figure}{PostFreeSurfer metric values}
\caption*{(i) NRMSE (left) (ii)Dice Coefficient (right)}
\label{fig:postfreesurfer_metric_values}
\end{center}
\hfill \break

Figure \ref{fig:postfreesurfer_metric_values} contains the matrices showing the plotted values of NRMSE (left) and Dice Coefficient (right). Each line in the matrix corresponds to a file common to all the subjects. Each column represents a subject and each row represents the same file in 5 different subjects. The files are sorted according to the modification time. The NRMSE value appears brighter if the images are dissimilar and it appears darker if the images are similar. Conversely, the Dice coefficient value appears darker if the images are dissimilar and appears brighter if the images are similar. We can also observe that the magnitude of differences varies across the files as well as the subjects.

\subsection{Comparison of specific files}
Figure~\ref{fig:postfreesurfer_high_nrmse} illustrates the differences in the ``aparc.a2009s+aseg.nii.gz" file. The file was taken from subject ``101410". The file illustrated here has an NRMSE value of 0.101 and the Dice coefficient value is 0.97. The red colored regions in the image shows the difference in the image in between two conditions (CentOS6 and CentOS7).

\hfill \break
\begin{center}
\includegraphics[width=\linewidth]{postfreesurfer-nrmse-aparc-a2009s+aseg}
\captionof{figure}{Illustrates the differences in the file with the highest NRMSE value in PostFreeSurfer Processing. \href{https://drive.google.com/file/d/1eeofWaPyk-A2pQd6LlieQwbMYVOrfeI3/view?usp=sharing}{Link}}
\caption*{(Subject: 101410; Filename: aparc.a2009s+aseg.nii.gz; Dice coeff.: 0.97 ; NRMSE: 0.101)}
\label{fig:postfreesurfer_high_nrmse}
\end{center}
\hfill \break

Figure~\ref{fig:postfreesurfer_ribbon_file} illustrates the differences in the ``T1w/ribbon.nii.gz" file. The file was taken from subject ``105216". The file illustrated here has an NRMSE value of 0.038 and the Dice coefficient value is 0.995. The red colored regions in the image shows the difference in the image in between two conditions (CentOS6 and CentOS7).

\hfill \break
\begin{center}
\includegraphics[width=\linewidth]{postfreesurfer-ribbon.png}
  \captionof{figure}{Illustrates the differences in the T1w Ribbon file. \href{https://drive.google.com/file/d/1PCj6gtoQSe3Cn6NAWuy2ZJq6xvm0tjh1/view?usp=sharing}{Link}}
\caption*{(Subject: 105216; Filename: T1w/ribbon.nii.gz; Dice coeff.: 0.995 ; NRMSE: 0.038)}
\label{fig:postfreesurfer_ribbon_file}
\end{center}
\hfill \break

Figure~\ref{fig:postfreesurfer_aparc_file} illustrates the differences in the ``MNINonlinear/aparc+aseg.nii.gz" file. The file was taken from subject ``101006". The file illustrated here has an NRMSE value of 0.073 and the Dice coefficient value is 0.98. The red colored regions in the image shows the difference in the image in between two conditions (CentOS 6 and CentOS7).
\hfill \break
\begin{center}
\includegraphics[width=.99\linewidth]{aparc+aseg_post.png}
\captionof{figure}{Illustrates the differences in the segmentation file. \href{https://drive.google.com/file/d/1_ZyAtveS1oVle8tAXeKsp1_4KdS2MVoB/view?usp=sharing}{Link}}
\caption*{(Subject: 101006; Filename: MNINonlinear/aparc+aseg.nii.gz; Dice coeff.: 0.98 ; NRMSE: 0.073)}
\label{fig:postfreesurfer_aparc_file}
\end{center}
\hfill \break

\section{fMRIVolume}\label{sec:fMRI}
1152 files were found to have inter-OS differences after fMRIVolume processing which were common to all subjects. Table~\ref{tab:fMRIVolume_Metric_Values} contains the mean, median and standard deviation values of the files having differences after fMRIVolume processing.
\subsection{Global comparison}
The general findings about the differences in the output images due to the fMRIVolume processing is discussed in this section.
\hfill \break
\begin{center}
\begin{tabular}{|l|l|l|}
\hline
\textbf{Item}      & \textbf{Nrmse}  & \textbf{Dice} \\ \hline
Mean               & 0.0160    & 0.5605   \\ \hline
Median             & 0.0090     & 0.7511   \\ \hline
Standard Deviation & 0.0196     & 0.3769   \\ \hline
\end{tabular}
\captionof{table}{NRMSE \& DICE values for fMRIVolume processing on CentOS6 and CentOS7}
\label{tab:fMRIVolume_Metric_Values}
\end{center}
\hfill \break

Table \ref{tab:fMRIVolume_Metric_Values} contains the mean, median and standard deviation of the files having differences produced by the fMRIVolume pipeline on CentOS6 and CentOS7 operating systems. Dice Coefficient shows that out of the results we obtained from fMRIVolume processing on two conditions, there was 56\% similarity while taking the average of Dice coefficient of every file that we found to have a checksum difference. The Dice coefficient value is just above half meaning the images are having above 40\% dissimilarity which is considered to be low.

\hfill \break
\begin{center}
\includegraphics[width=.5\linewidth]{fmri_NRMSE.png}%
\includegraphics[width=.5\linewidth]{fmri_DICE.png}
\captionof{figure}{fMRIVolume metric values}
\caption*{(i) NRMSE (left) (ii)Dice Coefficient (right)}
\label{fig:fMRI_metric_values}
\end{center}
\hfill \break

Figure \ref{fig:fMRI_metric_values} contains the matrices showing the plotted values of NRMSE (left) and Dice Coefficient (right) with respect to the files having differences from the fMRIVolume pipeline preprocessing. Each line in the matrix corresponds to a file common to all the subjects. Each column represents a subject and each row represents the same file in 5 different subjects. The files are sorted according to their modification time. The NRMSE value appears brighter if the images are dissimilar and it appears darker if the images are similar. Conversely, the Dice coefficient value appears darker if the images are dissimilar and appears brighter if the images are similar. We can also observe that the magnitude of differences varies across the files as well as the subjects.
\subsection{Comparison of specific files}
Figure~\ref{fig:allgrey_matter} illustrates the differences in the ``AllGreyMatter.nii.gz" file. The file was taken from subject ``101006". The file illustrated here has an NRMSE value of 0.074 and the Dice coefficient value is 0.99. The red colored regions in the image shows the differences (CentOS 6 and CentOS7).

\hfill \break
\begin{center}
\includegraphics[width=.75\linewidth]{Frontview2.png}%
\captionof{figure}{All Grey Matter file with differences (Blue shaded region shows the CentOS 6 output and yellow region shows the CentOS 7 output). \href{https://drive.google.com/file/d/1dzpyMalJ6_ox8jLedKvhKrP2ew7C7N-r/view?usp=sharing}{Link}}
\caption*{(Subject: 101006; Filename: AllGreyMatter.nii.gz; Dice coeff.; 0.99; NRMSE; .074)}
\label{fig:allgrey_matter} 
\end{center}
\hfill \break

Figure~\ref{fig:tfMRI_mask_file} illustrates the differences in the ``tfMRI\_MOTOR\_LR\_mc\_mask.nii.gz" file. The image on the left is the output from CentOS6 and the image on the right is the output from CentOS7. The files are taken from subject ``101006". The files illustrated here has an NRMSE value of 0.275 and the Dice coefficient value is 0.002. While comparing the images, we can find the differences visually.

\hfill \break
\begin{center}
\includegraphics[width=.5\linewidth]{tfMRI_MOTOR_LR_mc_mask_centos6.png}%
\includegraphics[width=.5\linewidth]{tfMRI_MOTOR_LR_mc_mask_centos7.png}
\captionof{figure}{Differences in tfMRI Motor MC Mask file. \href{https://drive.google.com/file/d/1_XpZnroleOlJmkvXHZA84iknT5UxtO14/view?usp=sharing}{Link}}
\caption*{(Subject: 105216; Filename: tfMRI\_MOTOR\_LR\_mc\_mask.nii.gz (CentOS6 on left, CentOS7 on right); Dice coeff.; 0.0002; NRMSE; 0.275)}
\label{fig:tfMRI_mask_file}
\end{center}
\hfill \break

Figure~\ref{fig:scout_gdc_file} illustrates the differences in the ``Scout\_gdc\_undistorted2T1w.nii.gz" file. The files are taken from subject ``101410". The files illustrated here has an NRMSE value of 0.010 and the Dice coefficient value is 0.778. The blue shaded region shows the difference in the image in between the two conditions.

\hfill \break
\begin{center}
\includegraphics[width=.99\linewidth]{gdc_scout.png}
\captionof{figure}{Differences in the Scout\_gdc\_undistorted2T1w file. \href{https://drive.google.com/file/d/1a6XuyGDm8pJ2WFccWEuHQnKpN-FL_Ryi/view?usp=sharing}{Link}}
\caption*{(Subject: 101410; Filename: Scout\_gdc\_undistorted2T1w.nii.gz ; Dice coeff.; 0.778; NRMSE; 0.010)}
\label{fig:scout_gdc_file}
\end{center}
\hfill \break

\section{Effect of changing subject Vs. Changing condition}\label{sec:comparison}
In order to quantify the effect of operating system on the output image and to compare the difference with the anatomical differences between subjects, we made a comparison with two subjects processed in the same condition (101107 and 101006) vs. the same subjects processed in two different conditions (CentOS6 and CentOS7). Subjects 101107 and 101006 processed using PreFreeSurfer on CentOS7 was compared against 101006, 101007 processed on CentOS6 and CentOS7 respectively. Table \ref{tab:comparison_table} contains the mean, median and standard deviation across the said conditions.

\hfill \break
\begin{center}
\begin{tabularx}{.98\textwidth}{|c|c|c|c|c|c|c|}
\hline
Item  & \makecell[l]{NRMSE\\(101006 \\ vs.\\101107)} & \makecell[l]{Dice Coeff.\\(101006\\ vs.\\101107)} & \makecell[l]{NRMSE\\101006\\CentOS\\(6Vs7)} & \makecell[l]{Dice Coeff.\\ 101006\\CentOS\\(6Vs7)} & \makecell[l]{NRMSE\\101107\\CentOS\\(6Vs7)} & \makecell[l]{Dice Coeff.\\ 101107\\CentOS\\(6Vs7)} \\ \hline
Average            & 0.092        & .265      & 0.0066     & 0.3014   & .0077   & .3001     \\ \hline
Median             & 0.078    & .0109       & 0.004          & 0.0217           & .0045     & .021  \\ \hline
\makecell[l]{Std.\\Dev} & 0.073     & 0.377           & 0.0092         & 0.3898   & .0100       & .385 \\ \hline
\end{tabularx}
\captionof{table}{Comparison: Anatomical differences vs. Effect of operating system}
\label{tab:comparison_table}
\end{center}
\vskip .2in
Comparing the metric values obtained from anatomical differences and effect of operating system differences, the operating system differences quantified by NRMSE value is 1/15\textsuperscript{th} (0.92/.0066) of the differences that are caused by the anatomical variations of the subjects.
